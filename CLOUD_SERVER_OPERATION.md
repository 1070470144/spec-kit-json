# äº‘æœåŠ¡å™¨æ“ä½œæŒ‡å—

## ğŸš€ å½“å‰ä»»åŠ¡ï¼šå¯åŠ¨é¡¹ç›®å¹¶æ›´æ–°

---

## ğŸ“‹ å¿«é€Ÿå¯åŠ¨æ­¥éª¤

### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ PM2 å®‰è£…å™¨ï¼ˆæ¨èï¼‰

#### 1. ä¸Šä¼ æœ€æ–°è„šæœ¬ï¼ˆå¦‚æœè¿˜æ²¡ä¸Šä¼ ï¼‰
```powershell
# å°†æœ¬åœ° scripts/pm2-installer.ps1 ä¸Šä¼ åˆ°æœåŠ¡å™¨ C:\pm2-installer.ps1
```

#### 2. åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œè„šæœ¬
```powershell
powershell -ExecutionPolicy Bypass -File C:\pm2-installer.ps1
```

#### 3. å¯åŠ¨æœåŠ¡
```
åœ¨èœå•ä¸­è¾“å…¥: 6
æŒ‰ Enter

é¢„æœŸè¾“å‡º:
  [OK] pm2 restarted

å¦‚æœæœåŠ¡æœªå¯åŠ¨ï¼Œé€‰æ‹©: 5 (start pm2)
```

#### 4. æ£€æŸ¥æœåŠ¡çŠ¶æ€
```powershell
# é€€å‡ºè„šæœ¬ï¼ˆè¾“å…¥ 0ï¼‰åï¼Œåœ¨ PowerShell ä¸­æ‰§è¡Œï¼š
npx pm2 list
npx pm2 logs juben --lines 20
```

---

### æ–¹æ¡ˆ 2ï¼šæ‰‹åŠ¨å¯åŠ¨ï¼ˆå¤‡ç”¨ï¼‰

```powershell
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd C:\apps\juben

# 2. æ£€æŸ¥ PM2 çŠ¶æ€
npx pm2 list

# 3. é‡å¯æœåŠ¡
npx pm2 restart juben

# å¦‚æœæœåŠ¡ä¸å­˜åœ¨ï¼Œå…ˆå¯åŠ¨ï¼š
npx pm2 start npm --name juben -- start

# 4. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤
npx pm2 logs juben --lines 20
```

---

## ğŸ”„ æ›´æ–°ä»£ç æµç¨‹

### æ¨èæµç¨‹ï¼šå…ˆå¯åŠ¨ â†’ å†è¿ç§»æ•°æ®åº“ â†’ æœ€åæ›´æ–°

#### ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨å½“å‰ç‰ˆæœ¬
```
ç›®çš„ï¼šå…ˆè®©ç½‘ç«™æ¢å¤è®¿é—®
æ–¹æ³•ï¼šèœå•é¡¹ 6 (restart) æˆ–èœå•é¡¹ 5 (start)
```

#### ç¬¬äºŒæ­¥ï¼šè¿ç§»æ•°æ®åº“ï¼ˆè§£å†³å†…å­˜é—®é¢˜ï¼‰
```
ç›®çš„ï¼šè§£å†³å¤‡ä»½å†…å­˜ä¸è¶³é—®é¢˜
æ–¹æ³•ï¼šèœå•é¡¹ 13 (migrate database to external storage)
æ­¥éª¤ï¼š
  1. é€‰æ‹© 13
  2. è¾“å…¥ y ç¡®è®¤
  3. ç­‰å¾…1-2åˆ†é’Ÿ
  4. è¾“å…¥ y åˆ é™¤æ—§æ–‡ä»¶
```

#### ç¬¬ä¸‰æ­¥ï¼šæ›´æ–°ä»£ç 
```
ç›®çš„ï¼šæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
æ–¹æ³•ï¼šèœå•é¡¹ 12 (one-key update)
æ­¥éª¤ï¼š
  1. é€‰æ‹© 12
  2. è¾“å…¥ y ç¡®è®¤
  3. ç­‰å¾…30ç§’å®Œæˆï¼ˆè¿ç§»åè¶…å¿«ï¼ï¼‰
```

---

## ğŸ“ å®Œæ•´æ“ä½œåºåˆ—

### åœ¨æœåŠ¡å™¨ PowerShell ä¸­æ‰§è¡Œï¼š

```powershell
# 1. è¿è¡Œ PM2 å®‰è£…å™¨
powershell -ExecutionPolicy Bypass -File C:\pm2-installer.ps1
```

ç„¶åä¾æ¬¡æ‰§è¡Œï¼š

```
# 2. å¯åŠ¨æœåŠ¡
select: 6
[Enter]

# 3. æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
select: 14
[Enter]

# 4. è¿ç§»æ•°æ®åº“åˆ°å¤–éƒ¨ï¼ˆè§£å†³å†…å­˜é—®é¢˜ï¼‰
select: 13
[Enter]
Confirm migration? (y/n): y
[Enter]
(ç­‰å¾…1-2åˆ†é’Ÿè‡ªåŠ¨å®Œæˆ)
Delete old files? (y/n): y
[Enter]

# 5. éªŒè¯è¿ç§»ç»“æœ
select: 14
[Enter]
(åº”è¯¥æ˜¾ç¤º: DB: External)

# 6. æ›´æ–°ä»£ç åˆ°æœ€æ–°ç‰ˆæœ¬
select: 12
[Enter]
Continue? (y/n): y
[Enter]
(ç­‰å¾…30ç§’å®Œæˆ)

# 7. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤
select: 8
[Enter]
(æŒ‰ Ctrl+C é€€å‡ºæ—¥å¿—)

# 8. é€€å‡ºè„šæœ¬
select: 0
[Enter]
```

---

## ğŸŒ éªŒè¯ç½‘ç«™åŠŸèƒ½

### è®¿é—®ç½‘ç«™æµ‹è¯•
```
ç½‘å€ï¼šwww.quanyuanzhuiyi.icu

æµ‹è¯•åŠŸèƒ½ï¼š
âœ“ æ‰“å¼€é¦–é¡µ
âœ“ ç”¨æˆ·ç™»å½•
âœ“ æµè§ˆå‰§æœ¬åˆ—è¡¨
âœ“ æŸ¥çœ‹å‰§æœ¬è¯¦æƒ…
âœ“ ä¸Šä¼ å‰§æœ¬/å›¾ç‰‡
âœ“ ç”Ÿæˆé¢„è§ˆå›¾
âœ“ ä¸‹è½½è¶…é«˜æ¸…å›¾ç‰‡

å…¨éƒ¨æ­£å¸¸å³æˆåŠŸï¼
```

---

## ğŸš¨ å¸¸è§é—®é¢˜å¤„ç†

### é—®é¢˜ 1ï¼šæœåŠ¡å¯åŠ¨å¤±è´¥
```powershell
# æ£€æŸ¥æ—¥å¿—
npx pm2 logs juben --lines 50

# æ£€æŸ¥ç¯å¢ƒå˜é‡
type C:\apps\juben\.env

# æ‰‹åŠ¨é‡å¯
npx pm2 restart juben
```

### é—®é¢˜ 2ï¼šç½‘ç«™æ— æ³•è®¿é—®
```powershell
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
npx pm2 list
# ç¡®è®¤ juben çŠ¶æ€ä¸º online

# æ£€æŸ¥ç«¯å£
netstat -ano | findstr :10080

# æ£€æŸ¥é˜²ç«å¢™
netsh advfirewall firewall show rule name=all | findstr 10080
```

### é—®é¢˜ 3ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥
```powershell
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶
# å†…éƒ¨æ¨¡å¼ï¼š
dir C:\apps\juben\prisma\dev.db

# å¤–éƒ¨æ¨¡å¼ï¼š
dir C:\apps\juben-data\database\juben.db

# é‡æ–°ç”Ÿæˆ Prisma å®¢æˆ·ç«¯
cd C:\apps\juben
npx prisma generate
```

---

## âš¡ å¿«é€Ÿå‚è€ƒ

### PM2 å¸¸ç”¨å‘½ä»¤
```powershell
npx pm2 list              # æŸ¥çœ‹æ‰€æœ‰æœåŠ¡
npx pm2 restart juben     # é‡å¯æœåŠ¡
npx pm2 stop juben        # åœæ­¢æœåŠ¡
npx pm2 start juben       # å¯åŠ¨æœåŠ¡
npx pm2 logs juben        # æŸ¥çœ‹æ—¥å¿—
npx pm2 logs juben -f     # å®æ—¶æ—¥å¿—
npx pm2 monit             # ç›‘æ§é¢æ¿
```

### é¡¹ç›®ç›®å½•
```
C:\apps\juben\              # é¡¹ç›®ä»£ç 
C:\apps\juben-data\         # å¤–éƒ¨æ•°æ®ï¼ˆè¿ç§»åï¼‰
C:\pm2-installer.ps1        # PM2 å®‰è£…å™¨è„šæœ¬
```

---

## ğŸ¯ æ¨èæ“ä½œé¡ºåº

**ä¼˜å…ˆçº§æ’åºï¼š**

1. **ç«‹å³å¯åŠ¨æœåŠ¡**ï¼ˆè®©ç½‘ç«™æ¢å¤è®¿é—®ï¼‰
   - èœå•é¡¹ï¼š6 (restart) æˆ– 5 (start)

2. **è¿ç§»æ•°æ®åº“**ï¼ˆè§£å†³å†…å­˜é—®é¢˜ï¼Œä¸€åŠ³æ°¸é€¸ï¼‰
   - èœå•é¡¹ï¼š13 (migrate)
   
3. **æ›´æ–°ä»£ç **ï¼ˆè·å–æœ€æ–°åŠŸèƒ½ï¼‰
   - èœå•é¡¹ï¼š12 (update)

4. **éªŒè¯åŠŸèƒ½**ï¼ˆç¡®ä¿ä¸€åˆ‡æ­£å¸¸ï¼‰
   - è®¿é—®ç½‘ç«™æµ‹è¯•

---

## âœ… æˆåŠŸæ ‡å¿—

### å¯åŠ¨æˆåŠŸ
- PM2 æ˜¾ç¤ºï¼š`juben | online`
- ç½‘ç«™å¯ä»¥æ­£å¸¸è®¿é—®

### è¿ç§»æˆåŠŸ
- èœå•æ˜¾ç¤ºï¼š`DB: External`
- çŠ¶æ€æ£€æŸ¥ï¼š`Database location: External`

### æ›´æ–°æˆåŠŸ
- æ›´æ–°æ—¶é—´ï¼š~30ç§’ï¼ˆæ¯”ä¹‹å‰å¿«10å€ï¼‰
- æ— å†…å­˜é”™è¯¯
- æ‰€æœ‰åŠŸèƒ½æ­£å¸¸

---

**æŒ‰è¿™ä¸ªé¡ºåºæ“ä½œï¼Œä½ çš„é¡¹ç›®å°†å¿«é€Ÿæ¢å¤å¹¶è§£å†³å†…å­˜é—®é¢˜ï¼** ğŸš€

éœ€è¦æˆ‘å®æ—¶æŒ‡å¯¼ä½ æ“ä½œå—ï¼Ÿ

