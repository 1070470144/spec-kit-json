# 032: 管理员批量上传添加自动生成预览图

## 状态
⏳ **规格完成，待实施**

## 需求
在管理员批量上传页面添加一个"自动生成预览图"选项，让批量上传的剧本自动生成预览图。

## 设计方案

### UI 改动

添加复选框控件：

```
┌─────────────────────────────────────┐
│ [选择文件夹或文件]                  │
│                                     │
│ ✅ 自动生成预览图                   │  ← 新增
│ 为所有上传的剧本自动生成预览图      │
│                                     │
│ [开始批量上传]  [返回列表]          │
└─────────────────────────────────────┘
```

### 功能流程

#### 不勾选（默认）
```
上传 JSON → 创建剧本 → 完成
```

#### 勾选后
```
上传 JSON → 创建剧本 → 生成预览图 ✅ → 完成
```

### 关键实现

```typescript
// 1. 添加状态
const [autoGeneratePreview, setAutoGeneratePreview] = useState(false)

// 2. 上传后调用预览图 API
if (autoGeneratePreview && scriptId) {
  await fetch(`/api/scripts/${scriptId}/auto-preview`)
}
```

## 时间估算

**不生成预览图：**
- 10 个剧本: ~2-5秒

**生成预览图：**
- 10 个剧本: ~12-25秒
- 平均: ~1.2-2.5秒/个

## 优势

| 特性 | 之前 | 现在 |
|------|------|------|
| 批量上传后有预览图 | ❌ 没有 | ✅ 自动生成 |
| 需要手动访问详情页 | ✅ 需要 | ❌ 不需要 |
| 管理效率 | ⚠️ 低 | ✅ 高 |

## 实施步骤

1. ✅ 添加复选框 UI
2. ✅ 添加状态管理
3. ✅ 修改上传循环逻辑
4. ✅ 添加预览图生成调用
5. ✅ 更新进度反馈
6. ✅ 测试验证

## 测试清单

- [ ] 默认不生成（快速上传）
- [ ] 勾选后生成（显示进度）
- [ ] 预览图生成失败不影响上传
- [ ] 批量上传性能测试
- [ ] 进度反馈准确

## 相关文件

- `app/admin/scripts/batch/page.tsx` - 需要修改
- `app/api/scripts/[id]/auto-preview/route.ts` - 已有 API

## 相关文档

- [spec.md](./spec.md) - 详细技术规范 ⭐

## 注意事项

1. **性能影响**: 生成预览图会增加上传时间（~1-2s/个）
2. **错误处理**: 预览图生成失败不影响剧本上传成功
3. **用户体验**: 显示清晰的进度提示
4. **可选功能**: 默认不勾选，由管理员决定

## 用户价值

- ✅ 批量上传后立即可预览
- ✅ 无需手动访问每个剧本详情页
- ✅ 提升管理效率
- ✅ 更好的视觉体验

