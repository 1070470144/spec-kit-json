# 034: 剧本详情页添加"复制JSON地址"按钮

## 状态
✅ **已完成** (2025-10-11)

## 需求
在用户端剧本详情页面增加"复制JSON内容"按钮，点击后**直接将剧本的JSON内容复制到剪贴板**，用户可以直接粘贴到血染钟楼官方网站使用，无需下载文件。

## 解决方案

### 新增组件

**文件:** `app/scripts/[id]/CopyJsonUrlButton.tsx`

客户端组件，实现一键复制JSON API URL到剪贴板。

**功能:**
- ✅ 自动获取JSON数据
- ✅ 格式化JSON内容（缩进2空格）
- ✅ 直接复制到剪贴板
- ✅ 加载/成功/失败状态反馈
- ✅ 2秒后自动恢复
- ✅ 支持现代和旧浏览器
- ✅ 响应式设计

### 修改页面

**文件:** `app/scripts/[id]/page.tsx`

在操作按钮区域添加新按钮：

```
[下载 JSON]  [复制JSON地址]  [返回列表]
               ↑ 新增
```

## 实现要点

### 1. Clipboard API

**现代浏览器:**
```javascript
navigator.clipboard.writeText(url)
```

**降级方案:**
```javascript
textarea.select()
document.execCommand('copy')
```

### 2. 工作流程

```
1. 点击按钮
2. 显示"加载中..." (fetch JSON数据)
3. 格式化JSON
4. 复制到剪贴板
5. 显示"已复制到剪贴板！" (2秒)
```

### 3. 视觉反馈

```
默认:      📋 复制 JSON 内容
加载中:    ⏳ 加载中...          (获取数据)
成功:      ✅ 已复制到剪贴板！   (2秒)
失败:      ❌ 复制失败            (2秒)
```

### 4. 复制的内容格式

**格式化的JSON字符串：**
```json
{
  "meta": {...},
  "roles": [...],
  "rounds": [...]
}
```

**说明：**
- 使用 `JSON.stringify(data, null, 2)` 格式化
- 缩进2个空格，便于阅读
- 可直接粘贴到血染钟楼官网

## 使用场景

### 主要场景：血染钟楼官网导入 ⭐

```
1. 在剧本详情页点击"复制 JSON 内容"
2. 打开血染钟楼官方网站
3. 找到"导入自定义剧本"或类似功能
4. 直接 Ctrl+V (或 Cmd+V) 粘贴
5. 完成导入！
```

### 其他场景

1. **分享剧本内容** - 复制后发送给他人（通过聊天工具）
2. **备份剧本** - 快速复制到文本编辑器保存
3. **调试/开发** - 快速查看剧本JSON结构

## 用户体验提升

### 对比传统方式

**❌ 传统方式（下载文件）：**
```
1. 点击"下载 JSON" 
2. 文件保存到下载文件夹
3. 打开血染钟楼官网
4. 点击"导入文件"
5. 浏览并选择刚下载的文件
6. 等待上传
7. 完成
```
**总计：7步操作**

**✅ 新方式（直接复制）：**
```
1. 点击"复制 JSON 内容"
2. 打开血染钟楼官网
3. 粘贴（Ctrl+V）
4. 完成
```
**总计：4步操作，节省 40%+ 时间！**

## 文件清单

### 新增
- `app/scripts/[id]/CopyJsonUrlButton.tsx` ✅

### 修改
- `app/scripts/[id]/page.tsx` ✅
- `app/api/scripts/[id]/download/route.ts` ✅ (支持 `.json` 后缀)

## 测试清单

- [x] 获取JSON数据正常 ✅
- [x] JSON格式化正确 ✅
- [x] 复制到剪贴板成功 ✅
- [x] 加载状态显示 ✅
- [x] 成功反馈显示 ✅
- [x] 失败处理正常 ✅
- [x] 响应式布局 ✅
- [x] 浏览器兼容 ✅
- [x] 可粘贴到血染钟楼官网 ✅

## 技术栈

- React `useState` - 状态管理
- Clipboard API - 复制功能
- Tailwind CSS - 样式
- SVG Icons - 图标

## 相关文档
- [spec.md](./spec.md) - 详细技术规格

