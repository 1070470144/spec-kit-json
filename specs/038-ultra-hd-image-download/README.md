# 超高清图片下载功能

## 概述

在生成图片页面新增"下载超高清图"按钮，生成文件大小≥10MB的超高质量PNG图片，适合专业打印和收藏。

## 快速信息

- **需求编号**: 038
- **实现难度**: ⭐⭐ (简单)
- **预计工作量**: 1-2小时
- **优先级**: 中等
- **影响范围**: 生成图片功能 (`/generate`)

## 核心特性

### 超高清参数（已优化提升）
- **DPI**: 1200 (提升2倍，普通版240)
- **缩放倍数**: 6x (提升1.5倍)
- **PNG质量**: 100 (无损)
- **压缩级别**: 0 (无压缩)
- **输出尺寸**: ~1680×4200px
- **文件大小**: 30-60MB ✨

### 用户界面
```
[下载 PNG (标准)]  [下载超高清图 ★]
  1-2MB              30-60MB
  适合网络分享        极致质量 专业打印
```

## 实现要点

### 1. API修改
在 `convert-svg-to-png/route.ts` 中接收 `quality` 参数：
```typescript
{ svg: string, quality?: 'normal' | 'ultra' }
```

### 2. 前端修改
在 `generate/page.tsx` 中：
- 新增 `downloadUltraHDPNG()` 函数
- 新增超高清下载按钮
- 添加加载提示和Toast消息

### 3. 文件命名
- 标准版: `剧本名_作者名.png`
- 超高清: `剧本名_作者名_UHD.png`

## 技术要点

### Sharp配置对比
```typescript
// 标准版
density: 240
quality: 90
compressionLevel: 9
maxDim: 2000
scale: 1x

// 超高清版（已优化）
density: 1200      // 提升2倍
quality: 100
compressionLevel: 0
maxDim: unlimited
scale: 6x          // 提升1.5倍
```

### 预期生成时间
- 标准PNG: 1-3秒
- 超高清PNG: 15-30秒 ⚠️ 文件更大，需要更长时间

## 用户体验优化

### Toast提示
1. 开始生成: "开始生成超高清图，预计需要15-30秒，文件约30-60MB"
2. 成功: "超高清图片下载成功！文件大小: 45.8MB，耗时: 22.3秒"
3. 失败: "超高清图生成失败，请重试"

### 按钮状态
- 生成中: 显示加载动画 + "生成中"
- 禁用状态: 另一个下载进行中时
- 成功后: 恢复正常状态

## 测试要点

- [ ] 文件大小≥30MB ✨✨（已优化提升）
- [ ] 图片质量极致提升（1200 DPI，6倍放大）
- [ ] 加载提示清晰
- [ ] 不影响标准PNG下载
- [ ] 移动端布局正常

## 注意事项

1. **服务器资源**: 超高清转换消耗更多CPU/内存（1200 DPI + 6倍放大）
2. **等待时间**: 需要15-30秒，必须有明确提示
3. **文件大小**: 30-60MB，下载可能较慢
4. **浏览器兼容**: 测试不同浏览器的大文件下载

## 文件清单

### 需要修改
- `app/api/tools/convert-svg-to-png/route.ts`
- `app/generate/page.tsx`

### 需要更新
- `GENERATE_IMAGE_FEATURE.md`

## 完成标准

1. ✅ 超高清PNG ≥30MB（已优化提升）
2. ✅ 质量极致提升（1200 DPI，6倍放大）
3. ✅ 下载功能稳定
4. ✅ 提示信息友好
5. ✅ 移动端正常工作

---

**准备好实现了吗？** 详细技术规格请查看 `spec.md`

